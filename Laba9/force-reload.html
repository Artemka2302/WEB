<!DOCTYPE html>
<html>
<body>
    <h1>Сброс кэша заказов</h1>
    <button onclick="clearCache()">Очистить кэш</button>
    <button onclick="reloadDishes()">Перезагрузить блюда</button>
    <button onclick="testOrders()">Тест заказов</button>
    <div id="result"></div>
    
    <script>
        const API_KEY = "32342745-3e72-4fcc-8f7a-a5a0c1703144";
        
        function clearCache() {
            localStorage.removeItem('selectedDishes');
            localStorage.removeItem('allDishes');
            sessionStorage.clear();
            document.getElementById('result').innerHTML = '<p>✅ Кэш очищен</p>';
            console.log('Кэш очищен');
        }
        
        async function reloadDishes() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Загружаем блюда...</p>';
            
            try {
                const response = await fetch(`https://edu.std-900.ist.mospolytech.ru/labs/api/dishes?api_key=${API_KEY}`);
                const dishes = await response.json();
                
                // Сохраняем в localStorage
                localStorage.setItem('allDishes', JSON.stringify(dishes));
                resultDiv.innerHTML += `<p>✅ Загружено ${dishes.length} блюд</p>`;
                
                // Обновляем глобальную переменную
                window.dishes = dishes;
                console.log('Блюды обновлены:', window.dishes.length);
                
            } catch (error) {
                resultDiv.innerHTML += `<p>❌ Ошибка: ${error.message}</p>`;
            }
        }
        
        async function testOrders() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Тестируем заказы...</p>';
            
            try {
                const response = await fetch(`https://edu.std-900.ist.mospolytech.ru/labs/api/orders?api_key=${API_KEY}`);
                const orders = await response.json();
                
                resultDiv.innerHTML += `
                    <p>✅ Заказов: ${orders.length}</p>
                    <p>Последний заказ:</p>
                    <pre>${JSON.stringify(orders[0], null, 2)}</pre>
                `;
                
            } catch (error) {
                resultDiv.innerHTML += `<p>❌ Ошибка: ${error.message}</p>`;
            }
        }
        
        // Автоматически тестируем при загрузке
        testOrders();
    </script>
</body>
</html>